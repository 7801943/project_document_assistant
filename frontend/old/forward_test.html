<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>文件预览测试</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        button { font-size: 1.5em; padding: 15px 30px; cursor: pointer; }
    </style>
</head>
<body>

    <button onclick="previewFile()">预览 test.pdf</button>

    <script>
        function previewFile() {
            const fastapiBaseUrl = 'http://[240e:478:80:e09:492:6b06:8550:3ed]:8888';
            const filename = 'test.pdf';
            const fileDownloadUrl = `http://host.docker.internal:8888/download/${filename}`;

            // !!!!! 核心修改 !!!!!
            // 1. 参数名改为 file_url
            // 2. 直接传递原始 URL，不再需要 encodeURIComponent
            const previewProxyUrl = `${fastapiBaseUrl}/kkfileview/onlinePreview?file_url=${fileDownloadUrl}`;

            console.log('正在打开预览窗口:', previewProxyUrl);
            window.open(previewProxyUrl, '_blank');
        }
    </script>

</body>
</html>